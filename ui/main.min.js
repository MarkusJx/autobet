let startstop=document.getElementById("startstop"),progressbar=document.getElementById("progressbar");mdc.ripple.MDCRipple.attachTo(startstop),mdc.linearProgress.MDCLinearProgress.attachTo(progressbar);const showqrbutton=document.getElementById("showqrbutton"),qrcontainer=document.getElementById("qrcontainer"),qrdonebutton=document.getElementById("qrdonebutton");mdc.ripple.MDCRipple.attachTo(showqrbutton);const moneythishour=document.getElementById("moneythishour"),raceswon=document.getElementById("raceswon"),winprobability=document.getElementById("winprobability"),moneyall=document.getElementById("moneyall");let errordialog=document.getElementById("error-dialog-container");const namecontainter=document.getElementById("namecontainer"),weblink=document.getElementById("weblink");mdc.ripple.MDCRipple.attachTo(weblink),mdc.autoInit();let qrdialog=document.getElementById("qrdialog");qrdialog=new mdc.dialog.MDCDialog(qrdialog);let stoptext=document.getElementById("stoptext");const enable_webserver=new mdc.switchControl.MDCSwitch(document.getElementById("enable-webserver-switch")),settings_saved_msg=new mdc.snackbar.MDCSnackbar(document.getElementById("settings-saved-message"));settings_saved_msg.timeoutMs=4e3;const game_running=document.getElementById("game-running");async function setQuitCallback(){autobetLib.callbacks.setQuitCallback(()=>{electron.quit()})}errordialog=new mdc.dialog.MDCDialog(errordialog),setQuitCallback(),namecontainter.onmouseenter=()=>{namecontainter.classList="hovered subcontainer",document.getElementById("copyright").classList="hovered"},namecontainter.onmouseleave=()=>{namecontainter.classList="subcontainer",document.getElementById("copyright").classList=""};let moneyMade=0,won=0,lost=0,gta_running=!1;function showQRCode(){qrdialog.open(),startstop.disabled=!0,showqrbutton.disabled=!0}function exception(){errordialog.open(),errordialog.listen("MDCDialog:closed",(function(){autobetLib.shutdown(),electron.quit()}))}function makeSumsDisplayable(sum,k=!1){let negative=sum<0;return(sum=Math.abs(sum))>1e9?negative?Math.round(sum/1e8)/10*-1+"B":Math.round(sum/1e8)/10+"B":sum>1e6?negative?Math.round(sum/1e5)/10*-1+"M":Math.round(sum/1e5)/10+"M":k&&sum>1e3?negative?Math.round(sum/100)/10*-1+"K":Math.round(sum/100)/10+"K":negative?-1*sum:sum}function addMoney(value){0!=value?(moneyMade+=value,value>0&&won++):lost++,updateValues()}function setAllMoneyMade(value){moneyall.innerHTML=makeSumsDisplayable(value)+" $"}function updateValues(){moneythishour.innerHTML=makeSumsDisplayable(getMoneyPerHour(),!0)+" $/hr",raceswon.innerHTML=won,winprobability.innerHTML=Math.round(won/(won+lost)*1e3)/10+"%"}function getMoneyPerHour(){return moneyMade*(3600/time)}function set_gta_running(val){console.log("set gta v running to "+val),gta_running=val,gta_running?(game_running.innerHTML="Yes",game_running.className="text status_running maintext"):(game_running.innerHTML="No",game_running.className="text status_stopped maintext")}function setQRCode(ip){console.log("Got own IP: "+ip),new QRCode(document.getElementById("qrcode"),{text:"http://"+ip+":8027",width:352,height:352,colorDark:"#000000",colorLight:"#ffffff"})}function setIPs(){let ip=autobetLib.getIP();weblink.innerHTML="http://"+ip+":8027",setQRCode(ip)}async function main(){startstop.disabled=!0,titlebar.create(),setIPs(),enable_webserver.disabled=!0,await autobetLib.loadWinnings();let initialized=await autobetLib.init();initialized?(statusinfo.classList.remove("status_init"),statusinfo.classList.add("status_stopped"),statusinfo.innerHTML="Stopped",console.log("Initialized."),startstop.disabled=!0):console.error("Could not initialize"),custom_betting_pos.value=autobetLib.settings.getCustomBettingPos(),time_sleep_field.value=autobetLib.settings.getTimeSleep(),clicks_field.value=autobetLib.settings.getClicks(),use_controller.checked=autobetLib.controller.getUseController(),setScpVBusInstalled(autobetLib.controller.scpVBusInstalled()),log_to_file_switch.checked=autobetLib.logging.isLoggingToFile(),enable_webserver.checked=autobetLib.settings.webServerActivated(),autobetLib.settings.webServerActivated()&&(initialized=await autobetLib.startWebServer(),enable_webserver.checked=initialized,initialized?console.log("Web server started."):console.error("Could not start web server")),enable_webserver.disabled=!1,autobetLib.start()}qrdialog.listen("MDCDialog:closing",(function(){startstop.disabled=!1,showqrbutton.disabled=!1})),showqrbutton.addEventListener("click",(function(){showQRCode()})),autobetLib.callbacks.setExceptionCallback(exception),autobetLib.callbacks.setAddMoneyCallback(addMoney),autobetLib.callbacks.setAllMoneyMadeCallback(setAllMoneyMade),autobetLib.callbacks.setGtaRunningCallback(set_gta_running),weblink.addEventListener("click",()=>{autobetLib.openWebsite()}),enable_webserver.listen("change",()=>{enable_webserver.disabled=!0,autobetLib.settings.setWebServer(enable_webserver.checked).then(res=>{res||(enable_webserver.checked=autobetLib.settings.webServerRunning()),autobetLib.settings.saveSettings().then(()=>{enable_webserver.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})})}),window.onbeforeunload=function(){autobetLib.shutdown().then(()=>{})},main().then(()=>{console.log("Main finished.")});const description_dialog=new mdc.dialog.MDCDialog(document.getElementById("description-dialog")),custom_betting_pos=new mdc.textField.MDCTextField(document.getElementById("custom-betting-pos-position")),time_sleep_field=new mdc.textField.MDCTextField(document.getElementById("time-sleep-field")),clicks_field=new mdc.textField.MDCTextField(document.getElementById("clicks-field")),use_controller=new mdc.switchControl.MDCSwitch(document.getElementById("use-controller-switch")),controller_error_msg=new mdc.snackbar.MDCSnackbar(document.getElementById("controller-error-message")),full_debug=new mdc.switchControl.MDCSwitch(document.getElementById("full-debug-switch")),scpvbus_installing_msg=new mdc.snackbar.MDCSnackbar(document.getElementById("scpvbus-installing-message")),log_to_file_switch=new mdc.switchControl.MDCSwitch(document.getElementById("log-to-file-switch")),log_to_console_switch=new mdc.switchControl.MDCSwitch(document.getElementById("log-to-console-switch")),log_textfield=new mdc.textField.MDCTextField(document.getElementById("log-textfield")),set_betting_pos_template=document.getElementById("set-betting-pos-template"),scpvbus_installed=document.getElementById("scpvbus-installed"),install_scpvbus=document.getElementById("install-scpvbus"),log_textfield_resizer=document.getElementById("log-textfield-resizer");function setScpVBusInstalled(val){val?(scpvbus_installed.innerHTML="Yes",scpvbus_installed.className="text status_running maintext",install_scpvbus.innerText="UNINSTALL"):(scpvbus_installed.innerHTML="No",scpvbus_installed.className="text status_stopped maintext",install_scpvbus.innerText="INSTALL")}function showDescription(title,description){document.getElementById("description-dialog-title").innerHTML=title,description_dialog.content_.innerText=description,description_dialog.open()}function showScpVBusMessage(msg){scpvbus_installing_msg.close(),scpvbus_installing_msg.labelText=msg,scpvbus_installing_msg.open()}mdc.ripple.MDCRipple.attachTo(set_betting_pos_template),mdc.ripple.MDCRipple.attachTo(install_scpvbus),custom_betting_pos.input_.addEventListener("keyup",event=>{13===event.keyCode&&(event.preventDefault(),0!==custom_betting_pos.value.length&&(autobetLib.settings.setCustomBettingPos(Number(custom_betting_pos.value)),custom_betting_pos.disabled=!0,autobetLib.settings.saveSettings().then(()=>{custom_betting_pos.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})))}),set_betting_pos_template.addEventListener("click",()=>{}),time_sleep_field.input_.addEventListener("keyup",event=>{13===event.keyCode&&(event.preventDefault(),0!==time_sleep_field.value.length&&(autobetLib.settings.setTimeSleep(Number(time_sleep_field.value)),time_sleep_field.disabled=!0,autobetLib.settings.saveSettings().then(()=>{time_sleep_field.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})))}),clicks_field.input_.addEventListener("keyup",()=>{13===event.keyCode&&(event.preventDefault(),0!==clicks_field.value.length&&(autobetLib.settings.setClicks(Number(clicks_field.value)),clicks_field.disabled=!0,autobetLib.settings.saveSettings().then(()=>{clicks_field.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})))}),use_controller.listen("change",()=>{use_controller.disabled=!0,autobetLib.controller.setUseController(use_controller.checked).then(res=>{res||controller_error_msg.open(),autobetLib.settings.saveSettings().then(()=>{use_controller.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})})}),install_scpvbus.addEventListener("click",()=>{install_scpvbus.disabled=!0,autobetLib.controller.scpVBusInstalled()?(showScpVBusMessage("Uninstalling ScpVBus"),autobetLib.controller.uninstallScpVBus().then(res=>{showScpVBusMessage(res?"ScpVBus removed.":"ScpVBus removal failed."),setScpVBusInstalled(!res),install_scpvbus.disabled=!1})):(showScpVBusMessage("Installing ScpVBus"),autobetLib.controller.installScpVBus().then(res=>{showScpVBusMessage(res?"ScpVBus installed.":"ScpVBus installation failed."),setScpVBusInstalled(res),install_scpvbus.disabled=!1}))}),full_debug.listen("change",()=>{full_debug.disabled=!0,full_debug.checked?(log_to_file_switch.checked=!0,log_to_file_switch.disabled=!0,autobetLib.logging.setLogToFile(!0),autobetLib.settings.saveSettings().then(()=>{settings_saved_msg.close(),settings_saved_msg.open()})):log_to_file_switch.disabled=!1,autobetLib.settings.setDebugFull(full_debug.checked).then(res=>{res||(full_debug.checked=!1,console.warn("setDebugFull returned false")),full_debug.disabled=!1})}),log_to_file_switch.listen("change",()=>{log_to_file_switch.disabled=!0,autobetLib.logging.setLogToFile(log_to_file_switch.checked),autobetLib.settings.saveSettings().then(()=>{log_to_file_switch.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})}),log_to_console_switch.listen("change",()=>{autobetLib.logging.setLogToConsole(log_to_console_switch.checked),log_to_console_switch.checked?"56px"===log_textfield_resizer.style.height&&(log_textfield_resizer.style.height="178px"):(log_textfield.value="",log_textfield_resizer.style.height="56px")}),autobetLib.logging.setLogCallback(msg=>{log_textfield.input_.scrollTop+log_textfield.input_.clientHeight>=log_textfield.input_.scrollHeight-20?(log_textfield.value+=msg,log_textfield.input_.scroll({top:log_textfield.input_.scrollHeight,left:0})):log_textfield.value+=msg}),document.getElementById("custom-betting-pos-info").addEventListener("click",()=>{showDescription("Custom-betting-pos","Set a custom position for the 'increase bet' button. Use this setting only, when the program is only placing $100, when a bet should be placed. Press enter to save, use the value '-1' to use the default values.")}),document.getElementById("betting-pos-template-info").addEventListener("click",()=>{showDescription("Betting-pos-template","Set templates for different game resolutions and positions for the 'increase bet' button. Click on 'set' to begin.")}),document.getElementById("time-sleep-info").addEventListener("click",()=>{showDescription("Time-sleep","Set the time to sleep after a bet has started. Use this option, when the program did not immediately start a new bet when the race has finished. Press enter to save, the default value is 36.")}),document.getElementById("clicks-info").addEventListener("click",()=>{showDescription("Clicks","Set the clicks the program needs to place a max bet. Use this option, when the program does not place $10.000, when a bet should be placed. Press enter to save, the default value is 31.")}),document.getElementById("controller-info").addEventListener("click",()=>{showDescription("Controller simulation","Check this if you want to use a virtual controller to click the 'increase bet' button. In order to use this, scpVBus must be installed. Additionally, you must not have any other controllers plugged into your computer, as the game can only register one controller.")}),document.getElementById("scpvbus-info").addEventListener("click",()=>{showDescription("ScpVBus installed","This field shows if ScpVBus is installed. ScpVBus must be installed, when a virtual controller should be used to click the 'increase bet' button. Use the 'Install ScpVBus' button to download and install ScpVBus.")}),document.getElementById("install-scpvbus-info").addEventListener("click",()=>{showDescription("Install ScpVBus","Click on 'install' to install ScpVBus. ScpVBus is required to use virtual controllers. NOTE: You will need administrator privileges to install ScpVBus.")}),document.getElementById("full-debug-info").addEventListener("click",()=>{showDescription("Full Debug","This option will create a zip file called 'autobet_debug.zip' on you Desktop. This File will contain a log and screenshots for debugging purposes. IMPORTANT: If you submit this file anywhere, make sure to delete any personal information from the zip file.")}),document.getElementById("debug-info").addEventListener("click",()=>{showDescription("Debugging and logging","Log to File: Set if the program should log to a file. This option will automatically activated, when the full debug option is activated. Log to Console: This option will display logging information in the 'View log' text field.")});